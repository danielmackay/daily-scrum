@page "/daily-scrum"
@using Microsoft.AspNetCore.Components.Web
@using Microsoft.AspNetCore.Components.Forms
@inject NavigationManager NavigationManager

<PageTitle>Daily Scrum</PageTitle>

<h1>Daily Scrum</h1>

<p>Let's make the daily scrum great again.</p>

@* <a href="daily-scrum/preview" class="btn btn-primary">Generate Email</a> *@

<EditForm Model="@Model" OnValidSubmit="@HandleValidSubmit" FormName="generate">
    <DataAnnotationsValidator/>
    <ValidationSummary/>

    <div class="form-group" style="margin-bottom: 20px">
        <label for="name">Name:</label>
        <InputText id="name" class="form-control" @bind-Value="Model.Name"/>
    </div>

    <div class="form-group" style="margin-bottom: 20px">
        <label for="clientDays">Days until client booking:</label>
        <InputNumber id="clientDays" class="form-control" @bind-Value="Model.ClientDays"/>
    </div>

    <div class="form-group" style="margin-bottom: 20px">
        <label for="lastWorkingDay">Last Working Day:</label>
        <InputDate id="lastWorkingDay" class="form-control" @bind-Value="Model.LastWorkingDay"/>
    </div>

    <button type="submit" class="btn btn-primary">Generate</button>
</EditForm>

@code {
    [SupplyParameterFromForm] private DailyScrumInputModel Model { get; set; } = new();

    private void HandleValidSubmit()
    {
        // Handle the form submission here.

        // NOTE: This throws an exception, but apparently it's expected 🤦
        // https://github.com/dotnet/aspnetcore/issues/50478
        NavigationManager.NavigateTo($"/daily-scrum/preview?name={Model.Name}&clientDays={Model.ClientDays}&lastWorkingDay={Model.LastWorkingDay.ToString("O")}", true);
    }
}
